!function(){if(window.__POS_BILL_PINGER_V33__)return;window.__POS_BILL_PINGER_V33__=!0;let t=window.PING_POS_BIL_CFG||{},e=t.pingPosUrl||"",n=t.pingBilUrl||"",i=t.lsKey||"admin_sound_enabled",a=t.soundPosUrl||"",s=t.soundBilUrl||"",l=[a,a?a.replace(/\.wav(\?.*)?$/i,".mp3$1"):""].filter(Boolean),o=[s,s?s.replace(/\.wav(\?.*)?$/i,".mp3$1"):""].filter(Boolean),r=(t,...e)=>window.PING_DEBUG?console.log("[PING]",t,...e):void 0,c=()=>Date.now();function u(t){let e=new Audio;e.preload="auto",e.muted=!1,e.volume=1,e.crossOrigin="anonymous";let n=0;function i(n){e.src=t[n];try{e.load()}catch(i){}}return e.addEventListener("error",function(){n+1<t.length&&i(++n)}),t.length&&i(n),e}let d=window.__audioPos__||u(l),p=window.__audioBil__||u(o);window.__audioPos__=d,window.__audioBil__=p;let $=null;function f(){if($)return $;let t=window.AudioContext||window.webkitAudioContext;return t?$=new t:null}async function m(t=250,e=880){let n=f();if(!n)return;if("suspended"===n.state)try{await n.resume()}catch(i){}let a=n.createOscillator(),s=n.createGain();a.type="sine",a.frequency.setValueAtTime(e,n.currentTime),s.gain.setValueAtTime(.001,n.currentTime),s.gain.exponentialRampToValueAtTime(.2,n.currentTime+.02),s.gain.exponentialRampToValueAtTime(.001,n.currentTime+t/1e3),a.connect(s),s.connect(n.destination),a.start(),a.stop(n.currentTime+t/1e3+.02)}let y="0"!==localStorage.getItem(i),b=!!window.__soundUnlocked__;function _(){return!!y&&!!b}function w(){let t=document.getElementById("btn-enable-sound-inline");t&&(t.style.display=_()?"none":"")}async function h(){if(b)return!0;try{d.muted=!0,await d.play().catch(()=>{}),d.pause(),d.muted=!1,p.muted=!0,await p.play().catch(()=>{}),p.pause(),p.muted=!1}catch(t){}let e=f();if(e&&"running"!==e.state)try{await e.resume()}catch(n){}return b=!0,window.__soundUnlocked__=!0,r("Audio unlocked"),!0}function x(){let t=document.getElementById("btn-enable-sound-inline");t&&t.addEventListener("click",async()=>{await h(),y=!0,localStorage.setItem(i,"1");let t=await T("pos");w(),t||w()})}function g(){let t=document.getElementById("btn-enable-sound");if(!t)return;let e=()=>{y?(t.classList.remove("btn-outline-secondary"),t.classList.add("btn-success"),t.innerHTML='<span class="btn-label"><i class="fe-volume-2"></i></span>Suara ON'):(t.classList.add("btn-outline-secondary"),t.classList.remove("btn-success"),t.innerHTML='<span class="btn-label"><i class="fe-volume-x"></i></span>Suara OFF')};t.addEventListener("click",async()=>{await h(),y=!y,localStorage.setItem(i,y?"1":"0"),y&&T("pos").catch(()=>{}),e(),w()}),e()}function v(){if(window.__autoUnlockBound__)return;window.__autoUnlockBound__=!0;let t=["pointerdown","click","touchstart","keydown"],e=async()=>{await h(),y&&localStorage.setItem(i,"1"),w(),t.forEach(t=>window.removeEventListener(t,e,!0))};t.forEach(t=>window.addEventListener(t,e,{once:!0,capture:!0,passive:!0}))}async function T(t){let e="pos"===t?d:p;try{return e.currentTime=0,await e.play(),!0}catch(n){return r("HTMLAudio play blocked:",n&&n.name),await m(250,"pos"===t?880:660),w(),!1}}let E={pos:0,bil:0};async function L(t){if(!y)return;let e=c();if(e-E[t]<5e3)return;E[t]=e,w(),await h();let n=await T(t);n&&_()&&w(),showToast(`${"pos"===t?"POS":"Billiard"}: ada yang baru tuh`,"success",{sticky:!0})}let B={pos:{total:null,max_id:null,last_ts:null},bil:{total:null,max_id:null,last_ts:null}},k=0,I=!1;async function P(t){let e=await fetch(t,{cache:"no-store",credentials:"same-origin"});if(!e.ok)throw Error("HTTP "+e.status);return e.json()}async function C(t,e,n){if(!e)return;let i=await P(e);if(i&&i.success){let a={total:Number(i.total||0),max_id:Number(i.max_id||0),last_ts:i.last_ts?String(i.last_ts):null};if(null===B[n].total)B[n]=a,r(n.toUpperCase(),"baseline",a);else{let s=function t(e,n){let i=Number(e.total),a=Number(n.total),s=Number(e.max_id),l=Number(n.max_id),o=Number.isFinite(i)&&Number.isFinite(a)&&a>i,r=Number.isFinite(s)&&Number.isFinite(l)&&l>s;return o||r}(B[n],a),l=function t(e,n){let i=Number(e.total),a=Number(n.total),s=Number(e.max_id),l=Number(n.max_id);return!!(Number.isFinite(i)&&Number.isFinite(a)&&a!==i||Number.isFinite(s)&&Number.isFinite(l)&&l!==s)||!!e.last_ts&&!!n.last_ts&&String(n.last_ts)!==String(e.last_ts)}(B[n],a);if(r(n.toUpperCase(),{added:s,changed:l,prev:B[n],next:a}),B[n]=a,l){var o;"pos"===(o=n)?"function"==typeof window.reload_table&&window.reload_table(o+"-ping"):"function"==typeof window.reload_billiard_table&&window.reload_billiard_table(o+"-ping")}s&&L(n)}}}async function U(){if(I)return;I=!0;let t=!document.hidden,i=(t?1e4:2e4)*Math.min(4,1+.5*k);try{await Promise.all([C("pos",e,"pos"),C("bil",n,"bil")]),k=0}catch(a){k=Math.min(6,k+1)}finally{I=!1,setTimeout(U,i)}}"complete"===document.readyState||"interactive"===document.readyState?(g(),x(),v(),w()):document.addEventListener("DOMContentLoaded",()=>{g(),x(),v(),w()},{once:!0}),U(),document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(U,200)}),window.test_pos_sound=()=>T("pos"),window.test_bil_sound=()=>T("bil"),window.PING_DEBUG=window.PING_DEBUG||!1}();function showToast(t,e="success",n={}){let i=!!n.sticky,a=Number.isFinite(n.duration)?n.duration:2500;if(window.Swal){Swal.fire({toast:!1,icon:{danger:"error",warn:"warning"}[e]||e,title:t,position:"center",width:360,showConfirmButton:!1,showCloseButton:i,timer:i?void 0:a,timerProgressBar:!i,allowOutsideClick:!i,backdrop:!1,customClass:{popup:"g-center-toast"}});return}let s="toast-center-overlay",l=document.getElementById(s);l||((l=document.createElement("div")).id=s,l.style.cssText="position:fixed;inset:0;z-index:100000;display:flex;align-items:center;justify-content:center;pointer-events:none",document.body.appendChild(l));let o=document.createElement("div");o.setAttribute("role","status"),o.style.cssText="pointer-events:auto;position:relative;background:#111827;color:#fff;padding:12px 44px 12px 14px;border-radius:12px;box-shadow:0 8px 28px rgba(0,0,0,.35);opacity:0;transform:scale(.96);transition:.15s",o.textContent=t;let r=document.createElement("button");r.type="button",r.setAttribute("aria-label","Close"),r.innerHTML="&times;",r.style.cssText="position:absolute;top:6px;right:10px;background:transparent;border:none;color:#fff;font-size:18px;line-height:1;cursor:pointer;opacity:.85",r.addEventListener("click",()=>o.remove()),o.appendChild(r),l.appendChild(o),requestAnimationFrame(()=>{o.style.opacity="1",o.style.transform="scale(1)"}),i||setTimeout(()=>{o.style.opacity="0",o.style.transform="scale(.96)",setTimeout(()=>o.remove(),150)},a)}